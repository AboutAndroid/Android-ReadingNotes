#读：编程的智慧
本文来自：[书生依旧](https://github.com/ssyijiu)的[Android阅读笔记](https://github.com/ssyijiu/Android-ReadingNotes)，这不是博客，只是笔记，最纯粹的干货，转载请注明出处。     
阅读文章：[编程的智慧](http://www.yinwang.org/blog-cn/2015/11/21/programming-philosophy)

###反复推敲代码
> 以写出冗长复杂的代码为耻，不断的优化代码。

- 如果你总是匆匆写出代码，却从来不回头去推敲，修改和提炼，其实是不可能提高编程水平的。你会制造出越来越多平庸甚至糟糕的代码。
- 好的程序员，他们删掉的代码，比留下来的还要多很多。
- 就算再厉害的程序员，也需要经过一段时间，才能发现最简单优雅的写法。有时候你反复提炼一段代码，觉得到了顶峰，没法再改进了，可是过了几个月再回头来看，又发现好多可以改进和简化的地方。
###写优雅的代码
- 优雅的代码看起来就像一些整齐的盒子。如果你把所有的物品都丢在一个很大的抽屉里，它们就会全部混在一起，当你使用的某个物品是就很难迅速的找到，但是如果你在抽屉里放几个小盒子。把物品分门别类的放进去，那么使用时就可以很方便的找到你需要的物品。
- 枝丫分明，if语句最好有两个分支，几乎每个if都有一个else与之对应。
    ```
    if (...) {
        if (...) {
             ...
        } else {
            ...
        }
    } else if (...) {
        ...
    } else {
        ...
    }
    ```

- 思考

    ```
    // 枝丫分明
    if(i == 0) {
        j = 0;
    } else
        j = 1;
    }
    // 只有一个if,没有与会之对应的else
    j = 1;
    if(i == 0) {
        j = 0;
    }
    ```
对于上面两种代码写法，从运行结果上来说是一样的，写哪种都可以，这个主要看编码者的习惯了。就我个人而言，如果if和else中的代码量差不多，我会写成第一种，因为这个时候我觉得if和else是两个不同的情况，他们的是平等的，没有什么主次之分。而如果else中的代码量远远小于if，我习惯写成第二种，此时我觉的if是主流程，而else只是主流程中的一个特殊，仅仅需要特殊处理一下。

###写模块化的代码
- 有些人吵着闹着要让程序“模块化”，结果他们的做法是把代码分部到多个文件和目录里面，然后把这些目录或者文件叫做“module”。真正的模块化，并不是文本意义上的，而是逻辑意义上的。一个模块应该像一个电路芯片，它有定义良好的输入和输出。实际上一种很好的模块化方法早已经存在，它的名字叫做“函数”。
- 思考：这里作者说将代码分布到不同的文件中并不是真正的模块化。但是将代码按照不同的功能、逻辑等分在不同的文件中确实非常有利于后期的维护。试想一下，一个文件中有100个函数，一个包中有100个文件的情形，看瞎眼~
###如何写好一个函数
- 避免写太长的函数，别超过40行。
- 制造小的工具函数。简言之，xxxUtil.java
- 每个函数只做一件事。
    ```
    // 根据 OS 的不同而做不同的事情    
    void foo() {
        if (getOS().equals("MacOS")) {
            a();
        } else {
            b();
        }
        c();
        if (getOS().equals("MacOS")) {
            d();
        } else {
            e();
        }
    }
    ```
如果一个函数可能做两种事情，它们之间共同点少于它们的不同点，那你最好就写两个不同的函数，否则这个函数的逻辑就不会很清晰，容易出现错误。其实，上面这个函数可以改写成两个函数：

    ```
    void fooMacOS() {
        a();
        c();
        d();
    }
    ```
    ```
    void fooOther() {
        b();
        c();
        e();
    }
    ```
- 如果你发现两件事情大部分内容相同，只有少数不同，多半时候你可以把相同的部分提取出去，做成一个辅助函数
    ```
    void foo() {
        a();
        b()
        c();
        if (getOS().equals("MacOS")) {
            d();
        } else {
            e();
        }
    }
    ```
其中a()，b()，c()都是一样的，只有d()和e()根据系统有所不同。那么你可以把a()，b()，c()提取出去：

    ```
    void preFoo() {
        a();
        b()
        c();
    }
    ```
然后制造两个函数：

    ```
    void fooMacOS() {
        preFoo();
        d();
    }
    ```
    
    ```
    void fooOther() {
        preFoo();
        e();
    }
    ```
- 避免使用全局变量和类成员（class member）来传递信息，尽量使用局部变量和参数。
###写可读的代码
> 可读的代码并不需要大量的注释。
- 使用有意义的函数和变量名字  
    
    ```
    put(elephant1, fridge2);  
    ```
- 局部变量应该尽量接近使用它的地方。  
   
    ```
    void foo() {
        ...
        ...
        int index = ...;
        bar(index);
        ...
    }
    ```    
如果index在顶上，读者可能会怀疑，它其实保存了某种会变化的数据，或者它后来又被修改过。 如果index放在下面，读者就清楚的知道，index并不是保存了什么可变的值，而且它算出来之后就没变过。  
局部变量的本质：它们就是电路里的导线，那你就能更好的理解近距离的好处。变量定义离用的地方越近，导线的长度就越短。你不需要摸着一根导线，绕来绕去找很远，就能发现接收它的端口，这样的电路就更容易理解。
- 局部变量名字应该简短
    ```
    boolean successInDeleteFile = deleteFile("foo.txt");
    if (successInDeleteFile) {
      ...
    } else {
      ...
    }
    ```
这个局部变量successInDeleteFile大可不必这么啰嗦。因为它**只用过一次**，而且**用它的地方就在下面一行**，所以读者可以轻松发现它是deleteFile返回的结果。如果你把它改名为success，其实读者根据一点上下文，也知道它表示"success in deleteFile"。所以你可以把它改成这样：

    ```
    boolean success = deleteFile("foo.txt");
    if (success) {
      ...
    } else {
      ...
    }
    ```
- 不要重用局部变量
    ```
    String msg;
    if (...) {
        msg = "succeed";
        log.info(msg);
    } else {
        msg = "failed";
        log.info(msg);
    }
    ```
虽然这样在逻辑上是没有问题的，然而却不易理解，容易混淆。变量msg两次被赋值，表示完全不同的两个值。它们立即被log.info使用，没有传递到其它地方去。这种赋值的做法，把局部变量的作用域不必要的增大，让人以为它可能在将来改变，也许会在其它地方被使用。更好的做法，其实是定义两个变量：

    ```
    if (...) {
        String msg = "succeed";
        log.info(msg);
    } else {
        String msg = "failed";
        log.info(msg);
    }
    ```
由于这两个 msg 变量的作用域仅限于它们所处的 i f语句分支，你可以很清楚的看到这两个msg被使用的范围，而且知道它们之间没有任何关系。  

**思考 :** 我以前就经常按照一种来写，当时心想少写一个 `String msg` 节约一点内存，现在想想，似乎后来修改的时候都要 `Ctrl + 左键` 看看这个 msg 在哪里定义的，以及什么时候被赋值，麻烦至极。
- 把复杂的逻辑提取出去，做成“帮助函数”。
    ```
    ...
    // 打开冰箱
    openDoor(fridge2);
    // 如果大象活着
    if (elephant1.alive()) {
      ...
    } else {  // 否则
       ...
    }
    // 关闭冰箱
    closeDoor(fridge2);
    ...
    ```
如果你把这片代码提出去定义成一个函数：

    ```
    void put(Elephant elephant, Fridge fridge) {
        openDoor(fridge);
        if (elephant.alive()) {
            ...
        } else {
            ...
        }
        closeDoor(fridge);
    }
    ```
这样原来的代码就可以改成：  

    ```
    ...
    put(elephant1, fridge2);
    ...
    ```
**思考 :**  这样的例子有很多，像 Android 中，跳转的一个 HomeActivity ，可以写一个函数 `goHomeActivity()`，把所有的逻辑都写在这个函数里面。
- 把复杂的表达式提取出去，做成中间变量。
    ```
    Pizza pizza = makePizza(crust(salt(), butter()),
       topping(onion(), tomato(), sausage()));
    ```
修改后 : 

    ```
    Crust crust = crust(salt(), butter());
    Topping topping = topping(onion(), tomato(), sausage());
    Pizza pizza = makePizza(crust, topping);
    ```
**思考 :**写第一种代码的人都有毒！写的时候是爽了，以后改的时候等着哭吧 ...
- 在合理的地方换行。  
    慎用IDE的代码整理功能，有时候它的换行真的很烂！为了避免IDE把这些手动调整好的换行弄乱，很多IDE（比如IntelliJ）的自动格式化设定里都有“保留原来的换行符”的设定。如果你发现IDE的换行不符合逻辑，你可以修改这些设定，然后在某些地方保留你自己的手动换行。

##五.
##六.总结

## 联系作者
- Github: [ssyijiu](https://github.com/ssyijiu)
- E-mail: lxmyijiu@163.com
- WeChat: ssyijiu11


